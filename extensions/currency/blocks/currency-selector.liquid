<div class="currency-selector-block">
  <h3 class="currency-selector-title">{{ block.settings.title }}</h3>
  <div class="currency-selector-container">
    <select id="currency-selector" class="currency-select">
      <option value="">Loading currencies...</option>
    </select>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      const response = await fetch('/apps/testing/api/currencies');
      const data = await response.json();
      
      const selector = document.getElementById('currency-selector');
      selector.innerHTML = ''; // Clear loading message
      
      // Add a default option
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'Select Currency';
      selector.appendChild(defaultOption);
      
      data.currencies.forEach(currency => {
        const option = document.createElement('option');
        option.value = currency.value;
        option.textContent = `${currency.label} (${currency.value})`;
        selector.appendChild(option);
      });

      // Add change event listener
      selector.addEventListener('change', async (e) => {
        const selectedCurrency = e.target.value;
        if (!selectedCurrency) return; // Skip if default option is selected
        
        try {
          const response = await fetch('/apps/testing/api/currencies', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              currencies: [{ value: selectedCurrency, label: e.target.options[e.target.selectedIndex].text }]
            })
          });
          
          if (response.ok) {
            // Reload the page to reflect changes
            window.location.reload();
          }
        } catch (error) {
          console.error('Error saving currency:', error);
        }
      });
    } catch (error) {
      console.error('Error loading currencies:', error);
    }
  });
</script> 

{% schema %}
{
  "name": "currency",
  "target": "body",
  "settings": [
    { "type": "product", "id": "product", "label": "product", "autofill": true },
    { "type": "color", "id": "colour", "label": "Star Colour", "default": "#ff0000" }
  ]
}
{% endschema %}